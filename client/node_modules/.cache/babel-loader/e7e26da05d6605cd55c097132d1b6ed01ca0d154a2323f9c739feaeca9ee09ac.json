{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\RK\\\\Downloads\\\\opentalk_voice_app\\\\client\\\\src\\\\pages\\\\Call1.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport socket from '../socket';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet pc;\nexport default function Call1({\n  user,\n  roomInfo,\n  setPage\n}) {\n  _s();\n  const remoteAudio = useRef();\n  const [inCall, setInCall] = useState(false);\n  const [partner, setPartner] = useState(roomInfo.partner || null);\n  const [roomId, setRoomId] = useState(roomInfo.roomId || null);\n  useEffect(() => {\n    socket.emit('iamonline', {\n      userId: user.id\n    });\n    if (roomId && partner) {\n      startPeer(roomId).catch(console.error);\n    }\n    const onOffer = async offer => {\n      if (!pc) await startPeer(roomId, false);\n      await pc.setRemoteDescription(offer);\n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n      socket.emit('answer', {\n        roomId,\n        answer\n      });\n    };\n    const onAnswer = async answer => {\n      if (pc) await pc.setRemoteDescription(answer);\n    };\n    const onIceCandidate = async candidate => {\n      if (pc) await pc.addIceCandidate(candidate);\n    };\n    socket.on('offer', onOffer);\n    socket.on('answer', onAnswer);\n    socket.on('ice-candidate', onIceCandidate);\n    return () => {\n      if (pc) pc.close();\n      pc = null;\n      socket.off('offer', onOffer);\n      socket.off('answer', onAnswer);\n      socket.off('ice-candidate', onIceCandidate);\n      window.onbeforeunload = null;\n    };\n  }, [roomId, partner]);\n  const startPeer = async (rId, initiator = true) => {\n    pc = new RTCPeerConnection();\n    setInCall(true);\n    let stream;\n    try {\n      stream = await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: false\n      });\n    } catch (err) {\n      console.error('getUserMedia failed', err);\n      setInCall(false);\n      return;\n    }\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n    pc.ontrack = e => {\n      if (remoteAudio.current) remoteAudio.current.srcObject = e.streams[0];\n    };\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        socket.emit('ice-candidate', {\n          roomId: rId,\n          candidate: event.candidate\n        });\n      }\n    };\n    if (initiator) {\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n      socket.emit('offer', {\n        roomId: rId,\n        offer\n      });\n    }\n    window.onbeforeunload = () => {\n      socket.emit('leave', {\n        userId: user.id,\n        roomId: rId\n      });\n    };\n  };\n  const leave = () => {\n    if (pc) pc.close();\n    pc = null;\n    if (roomId) socket.emit('leave', {\n      userId: user.id,\n      roomId\n    });\n    setInCall(false);\n    setPartner(null);\n    setRoomId(null);\n    window.onbeforeunload = null;\n\n    // ðŸ”¹ redirect to profile page\n    if (setPage) setPage('profile');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Call\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this), partner && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Partner: \", partner.username]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: remoteAudio,\n      autoPlay: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), !inCall && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Waiting to join call...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 19\n    }, this), inCall && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: leave,\n      children: \"Disconnect\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 18\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this);\n}\n_s(Call1, \"CZb8RixwrwPf7CYYD8dCa3ON6KQ=\");\n_c = Call1;\nvar _c;\n$RefreshReg$(_c, \"Call1\");","map":{"version":3,"names":["React","useEffect","useRef","useState","socket","jsxDEV","_jsxDEV","pc","Call1","user","roomInfo","setPage","_s","remoteAudio","inCall","setInCall","partner","setPartner","roomId","setRoomId","emit","userId","id","startPeer","catch","console","error","onOffer","offer","setRemoteDescription","answer","createAnswer","setLocalDescription","onAnswer","onIceCandidate","candidate","addIceCandidate","on","close","off","window","onbeforeunload","rId","initiator","RTCPeerConnection","stream","navigator","mediaDevices","getUserMedia","audio","video","err","getTracks","forEach","track","addTrack","ontrack","e","current","srcObject","streams","onicecandidate","event","createOffer","leave","children","fileName","_jsxFileName","lineNumber","columnNumber","username","ref","autoPlay","onClick","_c","$RefreshReg$"],"sources":["C:/Users/RK/Downloads/opentalk_voice_app/client/src/pages/Call1.js"],"sourcesContent":["\nimport React, { useEffect, useRef, useState } from 'react';\nimport socket from '../socket';\n\nlet pc;\n\nexport default function Call1({ user, roomInfo, setPage }) {\n  const remoteAudio = useRef();\n  const [inCall, setInCall] = useState(false);\n  const [partner, setPartner] = useState(roomInfo.partner || null);\n  const [roomId, setRoomId] = useState(roomInfo.roomId || null);\n\n  useEffect(() => {\n    socket.emit('iamonline', { userId: user.id });\n\n    if (roomId && partner) {\n      startPeer(roomId).catch(console.error);\n    }\n\n    const onOffer = async (offer) => {\n      if (!pc) await startPeer(roomId, false);\n      await pc.setRemoteDescription(offer);\n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n      socket.emit('answer', { roomId, answer });\n    };\n\n    const onAnswer = async (answer) => {\n      if (pc) await pc.setRemoteDescription(answer);\n    };\n\n    const onIceCandidate = async (candidate) => {\n      if (pc) await pc.addIceCandidate(candidate);\n    };\n\n    socket.on('offer', onOffer);\n    socket.on('answer', onAnswer);\n    socket.on('ice-candidate', onIceCandidate);\n\n    return () => {\n      if (pc) pc.close();\n      pc = null;\n      socket.off('offer', onOffer);\n      socket.off('answer', onAnswer);\n      socket.off('ice-candidate', onIceCandidate);\n      window.onbeforeunload = null;\n    };\n  }, [roomId, partner]);\n\n  const startPeer = async (rId, initiator = true) => {\n    pc = new RTCPeerConnection();\n    setInCall(true);\n\n    let stream;\n    try {\n      stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });\n    } catch (err) {\n      console.error('getUserMedia failed', err);\n      setInCall(false);\n      return;\n    }\n\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n    pc.ontrack = (e) => {\n      if (remoteAudio.current) remoteAudio.current.srcObject = e.streams[0];\n    };\n\n    pc.onicecandidate = (event) => {\n      if (event.candidate) {\n        socket.emit('ice-candidate', { roomId: rId, candidate: event.candidate });\n      }\n    };\n\n    if (initiator) {\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n      socket.emit('offer', { roomId: rId, offer });\n    }\n\n    window.onbeforeunload = () => {\n      socket.emit('leave', { userId: user.id, roomId: rId });\n    };\n  };\n\n  const leave = () => {\n    if (pc) pc.close();\n    pc = null;\n    if (roomId) socket.emit('leave', { userId: user.id, roomId });\n    setInCall(false);\n    setPartner(null);\n    setRoomId(null);\n    window.onbeforeunload = null;\n\n    // ðŸ”¹ redirect to profile page\n    if (setPage) setPage('profile');\n  };\n\n  return (\n    <div>\n      <h2>Call</h2>\n      {partner && <p>Partner: {partner.username}</p>}\n      <audio ref={remoteAudio} autoPlay />\n      {!inCall && <p>Waiting to join call...</p>}\n      {inCall && <button onClick={leave}>Disconnect</button>}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}