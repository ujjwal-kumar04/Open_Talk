{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\RK\\\\Downloads\\\\opentalk_voice_app\\\\client\\\\src\\\\pages\\\\Call.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet socket;\nlet pc;\nexport default function Call({\n  user\n}) {\n  _s();\n  const remoteAudio = useRef();\n  const [inCall, setInCall] = useState(false);\n  const [partner, setPartner] = useState(null);\n  const [roomId, setRoomId] = useState(null);\n  useEffect(() => {\n    socket = io('http://localhost:5000');\n    socket.on('connect', () => {\n      socket.emit('iamonline', {\n        userId: user.id\n      });\n    });\n    socket.on('matched', async ({\n      roomId,\n      partner\n    }) => {\n      setPartner(partner);\n      setRoomId(roomId);\n      await startPeer(roomId);\n    });\n    socket.on('offer', async offer => {\n      if (!pc) await startPeer(roomId, false);\n      await pc.setRemoteDescription(offer);\n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n      socket.emit('answer', {\n        roomId,\n        answer\n      });\n    });\n    socket.on('answer', async answer => {\n      if (pc) await pc.setRemoteDescription(answer);\n    });\n    socket.on('ice-candidate', async candidate => {\n      if (pc) await pc.addIceCandidate(candidate);\n    });\n    return () => {\n      if (socket) socket.disconnect();\n    };\n  }, []);\n  const startPeer = async (rId, initiator = true) => {\n    pc = new RTCPeerConnection();\n    setInCall(true);\n\n    // get only audio\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: false\n    });\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n    pc.ontrack = e => {\n      remoteAudio.current.srcObject = e.streams[0];\n    };\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        socket.emit('ice-candidate', {\n          roomId: rId,\n          candidate: event.candidate\n        });\n      }\n    };\n    if (initiator) {\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n      socket.emit('offer', {\n        roomId: rId,\n        offer\n      });\n    }\n    window.onbeforeunload = () => {\n      if (socket) socket.emit('leave', {\n        userId: user.id,\n        roomId: rId\n      });\n    };\n  };\n  const leave = () => {\n    if (pc) pc.close();\n    if (socket) socket.emit('leave', {\n      userId: user.id,\n      roomId\n    });\n    setInCall(false);\n    setPartner(null);\n    setRoomId(null);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Call\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }, this), partner && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Partner: \", partner.username]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: remoteAudio,\n      autoPlay: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), !inCall && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Waiting to join call...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 19\n    }, this), inCall && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: leave,\n      children: \"Disconnect\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 18\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 5\n  }, this);\n}\n_s(Call, \"p4U1AnJnX05CUqdd6AjFlh1bzUA=\");\n_c = Call;\nvar _c;\n$RefreshReg$(_c, \"Call\");","map":{"version":3,"names":["React","useEffect","useRef","useState","io","jsxDEV","_jsxDEV","socket","pc","Call","user","_s","remoteAudio","inCall","setInCall","partner","setPartner","roomId","setRoomId","on","emit","userId","id","startPeer","offer","setRemoteDescription","answer","createAnswer","setLocalDescription","candidate","addIceCandidate","disconnect","rId","initiator","RTCPeerConnection","stream","navigator","mediaDevices","getUserMedia","audio","video","getTracks","forEach","track","addTrack","ontrack","e","current","srcObject","streams","onicecandidate","event","createOffer","window","onbeforeunload","leave","close","children","fileName","_jsxFileName","lineNumber","columnNumber","username","ref","autoPlay","onClick","_c","$RefreshReg$"],"sources":["C:/Users/RK/Downloads/opentalk_voice_app/client/src/pages/Call.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { io } from 'socket.io-client';\n\nlet socket;\nlet pc;\n\nexport default function Call({ user }) {\n  const remoteAudio = useRef();\n  const [inCall, setInCall] = useState(false);\n  const [partner, setPartner] = useState(null);\n  const [roomId, setRoomId] = useState(null);\n\n  useEffect(() => {\n    socket = io('http://localhost:5000');\n\n    socket.on('connect', () => {\n      socket.emit('iamonline', { userId: user.id });\n    });\n\n    socket.on('matched', async ({ roomId, partner }) => {\n      setPartner(partner);\n      setRoomId(roomId);\n      await startPeer(roomId);\n    });\n\n    socket.on('offer', async (offer) => {\n      if (!pc) await startPeer(roomId, false);\n      await pc.setRemoteDescription(offer);\n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n      socket.emit('answer', { roomId, answer });\n    });\n\n    socket.on('answer', async (answer) => {\n      if (pc) await pc.setRemoteDescription(answer);\n    });\n\n    socket.on('ice-candidate', async (candidate) => {\n      if (pc) await pc.addIceCandidate(candidate);\n    });\n\n    return () => {\n      if (socket) socket.disconnect();\n    };\n  }, []);\n\n  const startPeer = async (rId, initiator = true) => {\n    pc = new RTCPeerConnection();\n    setInCall(true);\n\n    // get only audio\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n    pc.ontrack = (e) => {\n      remoteAudio.current.srcObject = e.streams[0];\n    };\n\n    pc.onicecandidate = (event) => {\n      if (event.candidate) {\n        socket.emit('ice-candidate', { roomId: rId, candidate: event.candidate });\n      }\n    };\n\n    if (initiator) {\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n      socket.emit('offer', { roomId: rId, offer });\n    }\n\n    window.onbeforeunload = () => {\n      if (socket) socket.emit('leave', { userId: user.id, roomId: rId });\n    };\n  };\n\n  const leave = () => {\n    if (pc) pc.close();\n    if (socket) socket.emit('leave', { userId: user.id, roomId });\n    setInCall(false);\n    setPartner(null);\n    setRoomId(null);\n  };\n\n  return (\n    <div>\n      <h2>Call</h2>\n      {partner && <p>Partner: {partner.username}</p>}\n      <audio ref={remoteAudio} autoPlay />\n      {!inCall && <p>Waiting to join call...</p>}\n      {inCall && <button onClick={leave}>Disconnect</button>}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}